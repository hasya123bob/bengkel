<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Owner dashboard bengkel">
    <meta name="author" content="Owner">

    <title>Dashboard Pemilik Bengkel</title>

    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- Additional CSS Files (bawaan landing page) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-finance-business.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
  </head>

  <body>
    <div class="dashboard-wrapper">
      <!-- Sidebar -->
      <div class="dashboard-sidebar">
        <div class="logo">
          Owner Bengkel
        </div>
        <ul>
          <li class="menu-title">Menu Utama</li>
          <li><a href="{{ url_for('owner_dashboard') }}" class="active">Dashboard Owner</a></li>
          <li><a href="{{ url_for('manage_employees') }}">Manajemen Karyawan</a></li>
          <li><a href="{{ url_for('manage_services') }}">Manajemen Layanan Bengkel</a></li>
          <li><a href="{{ url_for('manage_spareparts') }}">Manajemen Sparepart</a></li>
          <li><a href="{{ url_for('manage_transactions') }}">Manajemen Transaksi</a></li>
          <li><a href="{{ url_for('owner_reports') }}">Laporan</a></li>

          <li class="menu-title">Akses</li>
          <li><a href="{{ url_for('index') }}">Logout</a></li>
        </ul>
      </div>

      <!-- Konten -->
      <div class="dashboard-content">
        <!-- Topbar -->
        <div class="dashboard-topbar">
          <h4>Dashboard Pemilik</h4>
          <div>
            <span style="margin-right:15px; font-size:14px;">test</span>
            <span class="badge badge-secondary">Owner</span>
          </div>
        </div>

        <!-- Main -->
        <div class="dashboard-main">
          <!-- Deretan kartu ringkasan -->
          <div class="row">
            <div class="col-md-3 mb-4">
              <div class="card-stat">
                <div class="card-body">
                  <div class="label">Total Transaksi Bulan Ini</div>
                  <div class="value">{{ stats.total_transactions }}</div>
                  <div class="trend">
                    {% if stats.trx_change_pct > 0 %}
                      &#9650; {{ "%.1f"|format(stats.trx_change_pct) }}% dibanding bulan lalu
                    {% elif stats.trx_change_pct < 0 %}
                      &#9660; {{ "%.1f"|format(stats.trx_change_pct|abs) }}% dibanding bulan lalu
                    {% else %}
                      Tidak berubah dibanding bulan lalu
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-3 mb-4">
              <div class="card-stat">
                <div class="card-body">
                  <div class="label">Pendapatan Bulan Ini</div>
                  <div class="value">Rp {{ "{:,.0f}".format(stats.monthly_revenue) }}</div>
                  <div class="trend">
                    {% if stats.revenue_change_pct > 0 %}
                      &#9650; {{ "%.1f"|format(stats.revenue_change_pct) }}% dibanding bulan lalu
                    {% elif stats.revenue_change_pct < 0 %}
                      &#9660; {{ "%.1f"|format(stats.revenue_change_pct|abs) }}% dibanding bulan lalu
                    {% else %}
                      Tidak berubah dibanding bulan lalu
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-3 mb-4">
              <div class="card-stat">
                <div class="card-body">
                  <div class="label">Jumlah Karyawan Aktif</div>
                  <div class="value">{{ stats.active_employees }}</div>
                  <div class="trend">Termasuk mekanik &amp; admin</div>
                </div>
              </div>
            </div>

            <div class="col-md-3 mb-4">
              <div class="card-stat">
                <div class="card-body">
                  <div class="label">Stok Sparepart Rendah</div>
                  <div class="value">{{ stats.low_stock_items }}</div>
                  <div class="trend">Perlu restock</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ringkasan Penjualan + Ringkasan Transaksi -->
          <div class="row">
            <div class="col-lg-8 mb-4">
              <div class="card-section" style="height: 320px;">
                <div class="card-header">
                  <h5 class="mb-0">Ringkasan Penjualan</h5>
                </div>
                <div class="card-body" style="height: 260px;">
                  <p>Grafik total penjualan per hari pada bulan ini.</p>
                  <div style="position: relative; height: 200px;">
                    <canvas id="salesChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-4 mb-4">
              <div class="card-section">
                <div class="card-header">
                  <h5 class="mb-0">Ringkasan Transaksi</h5>
                </div>
                <div class="card-body">
                  <p>Jumlah transaksi per status:</p>
                  <ul>
                    <li>Selesai: {{ stats.completed_orders if stats.completed_orders is defined else 0 }}</li>
                    <li>Proses: {{ stats.pending_orders if stats.pending_orders is defined else 0 }}</li>
                  </ul>
                  <a href="{{ url_for('manage_transactions') }}" class="filled-button mt-2">Lihat Detail Transaksi</a>
                </div>
              </div>
            </div>
          </div>

          <!-- Analisis singkat SDM & stok -->
          <div class="row">
            <div class="col-lg-6 mb-4">
              <div class="card-section">
                <div class="card-header">
                  <h5 class="mb-0">Ringkasan SDM</h5>
                </div>
                <div class="card-body">
                  <p>Ada {{ stats.active_employees }} karyawan aktif yang siap melayani pelanggan.</p>
                  <a href="{{ url_for('manage_employees') }}" class="filled-button mt-2">Kelola Karyawan</a>
                </div>
              </div>
            </div>

            <div class="col-lg-6 mb-4">
              <div class="card-section">
                <div class="card-header">
                  <h5 class="mb-0">Ringkasan Stok</h5>
                </div>
                <div class="card-body">
                  <p>
                    {% if stats.low_stock_items > 0 %}
                      Terdapat {{ stats.low_stock_items }} sparepart yang stoknya mulai menipis dan perlu restock.
                    {% else %}
                      Tidak ada sparepart yang stoknya menipis.
                    {% endif %}
                  </p>
                  <a href="{{ url_for('manage_spareparts') }}" class="filled-button mt-2">Kelola Sparepart</a>
                </div>
              </div>
            </div>
          </div>

        </div> <!-- /dashboard-main -->
      </div> <!-- /dashboard-content -->
    </div> <!-- /dashboard-wrapper -->

    <!-- JS -->
    <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const salesCtx    = document.getElementById('salesChart').getContext('2d');
      const salesLabels = {{ chart_labels|tojson|safe }};
      const salesData   = {{ chart_values|tojson|safe }};

      new Chart(salesCtx, {
        type: 'line',
        data: {
          labels: salesLabels,
          datasets: [{
            label: 'Total Pendapatan (Rp)',
            data: salesData,
            borderColor: '#4e73df',
            backgroundColor: 'rgba(78, 115, 223, 0.1)',
            tension: 0.3,
            fill: true,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { title: { display: true, text: 'Tanggal' } },
            y: { title: { display: true, text: 'Pendapatan (Rp)' }, beginAtZero: true }
          },
          plugins: { legend: { display: false } }
        }
      });
    </script>
  </body>
</html>
